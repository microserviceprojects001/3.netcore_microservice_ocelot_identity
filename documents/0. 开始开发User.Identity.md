# 这个代码回到 userservice 工程里开发

https://github.com/microserviceprojects001/2.netcore_microservice_userService
D:\Code\1.microservice\2.netcore_microservice_userService

# 初始化工程

dotnet new webapi -n User.Identity --use-controllers
dotnet sln add User.Identity/User.Identity.csproj

# 引入接口 IExtensionGrantValidator

是为了扩展 IdentityServer4 的认证能力

1. OAuth2 标准授权类型（Grant Types）

- password: 用户直接提供用户名/密码换取 Token（不推荐）

- client_credentials: 客户端用自己的凭证换取 Token（服务间通信）

- authorization_code: 前端通过授权码换取 Token（最安全）

- refresh_token: 用 Refresh Token 换取新的 Access Token

2. 为什么需要 IExtensionGrantValidator？
   场景：当标准授权类型无法满足业务需求时

示例：

- 手机号 + 短信验证码登录

- 微信扫码登录

- LDAP/AD 域认证集成

- 硬件设备密钥认证

在 .NET 9.0 中，IExtensionGrantValidator 接口仍然可用且完全兼容。这是 IdentityServer4（或更高版本 IdentityServer）的核心扩展接口，用于实现自定义授权流程（如短信验证码、扫码登录等）

是的，IExtensionGrantValidator 的实现必须放在您的认证中心（IdentityServer 项目）中。

# 添加 nuget 包

dotnet add package Duende.IdentityServer --version 7.0.0

# soa 是什么

微服务可以看作是 SOA 的一种演进和具体实现形式
面向服务的架构
SOA（Service-Oriented Architecture） 是一种软件设计范式，核心思想是将应用程序功能拆分为可重用的服务

# Polly 是什么

Polly：微服务中的弹性保障框架
Polly 是一个强大的 .NET 弹性和瞬态故障处理库，专门为微服务架构设计，用于增强系统的容错能力和稳定性。它就像微服务世界的"安全气囊"，在系统遇到故障时提供保护机制。
Polly 完全支持 .NET 9.0
功能完整
所有核心策略均可用：

重试（Retry）：应对瞬时故障（如网络抖动）67。

熔断（Circuit Breaker）：防止级联故障（如下游服务不可用）13。

超时（Timeout）：避免资源阻塞 58。

降级（Fallback）：服务不可用时返回兜底数据 28。

限流（Rate Limit）：控制请求并发量
